{% extends "base.html" %}

{% block content %}
    <div class="modal" id="myModal">
      <div class="modal-background"></div>
      <div class="modal-content">
        <div class="box">
        <p class="title">Upload a New Book</p>
          <form action="" method="POST" enctype="multipart/form-data" novalidate>
              {{ form.hidden_tag() }}
              <div>
                <h5 class="title is-5">{{ form.title.label }}</h5>
                <div style="padding: 0px 10px 20px 10px;">
                  {{ form.title(class_="input") }}
                </div>
              </div>
              <div>
                  <h5 class="title is-5">{{ form.file.label }}</h5>
                  
                  <div style="padding: 0px 10px 20px 10px;">
                      <div id="i-file" class="file has-name is-fullwidth">
                          <label class="file-label">
                            {{ form.file(class_="file-input") }}
                            <span class="file-cta">
                              <span class="file-icon">
                                <i class="fas fa-upload"></i>
                              </span>
                              <span class="file-label">
                                Choose a fileâ€¦
                              </span>
                            </span>
                            <span class="file-name">
                              <i>No file uploaded</i>
                            </span>
                          </label>
                        </div>
                  </div>
              </div>
              <button type="submit" id="btnSubmit" onclick="whenSubmit()" class="button is-primary">Submit</button>
          </form>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close"></button>
    </div>

    <div class="card" style="margin: 10px 0;">
      <div class="card-content">
        <p class="title">Choose a book:</p>
        <form id="formSummarize" action="/summarize" method="POST">
          {% for b in books %}
            <input type="radio" name="book" value="{{ b.path_file }}""> {{ b.title }} <br>
          {% endfor %}
          <button type="submit" id="btnSummarize" onclick="whenChoose()" class="button is-primary">Summarize</button>
          <button type="button" id="showAddBook" class="button is-info modal-button" data-target="#myModal" aria-haspopup="true"><i class="fas fa-plus"></i><span>Add</span></button>
        </form>
        
      </div>
    </div>

    

    {% with result = get_flashed_messages() %}
    {% if result %}
    <div class="columns">
      <div class="column is-two-fifths">
            <embed src="/{{ result[0] }}" width="100%" height="300" />
      </div>
      <div class="column">
        <div class="card" style="margin: 10px 0;">
          <div class="card-content">
              <h4 class="title is-4">Result</h4>
              <p id="resultText" class="has-text-justified">
                  {{ result[1]|join('') }}
              </p>
          </div>
          <footer class="card-footer">
              <p class="card-footer-item">
                  <span>
                      <button type="button" class="button is-info" onclick="copyToClipboard()">
                        <i class="fas fa-copy"></i> &nbsp; Copy to Clipboard
                      </button>
                  </span>
                </p>
              <!-- <p class="card-footer-item">
                  <span>
                    <button type="button" class="button is-danger">
                      <i class="fas fa-file-export"></i> &nbsp; Export to PDF
                    </button>
                  </span>
              </p> -->
            </footer>
      </div>
      </div>
    </div>
    
    

    
    
   
    {% endif %}
    {% endwith %}

    <div id="snackbar">Some text some message..</div>

    <script>
        const fileInput = document.querySelector('#i-file input[type=file]');
            fileInput.onchange = () => {
            if (fileInput.files.length > 0) {
                const fileName = document.querySelector('#i-file .file-name');
                fileName.textContent = fileInput.files[0].name;
            }
        }

        document.querySelectorAll('.modal-button').forEach(function(el) {
          el.addEventListener('click', function() {
            var target = document.querySelector(el.getAttribute('data-target'));
            
            target.classList.add('is-active');
            
            target.querySelector('.modal-close').addEventListener('click',   function() {
                target.classList.remove('is-active');
             });
          });
        });

        function whenSubmit() {
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.classList.add('is-loading'); 
            return false;
        }

        function whenChoose() {
          const btnSummarize = document.getElementById('btnSummarize');
          btnSummarize.classList.add('is-loading'); 

          /*var path_file = $("input[name='book']:checked").val();

          $.ajax({
            url: "{{ url_for('summarize') }}",
            type: "POST",
            data: {'path_file': path_file},
            success: function()
          })*/

          return false;
        }

        function copyToClipboard() {
            var text = document.getElementById('resultText').innerText;
            var elem = document.createElement("textarea");
            document.body.appendChild(elem);
            elem.value = text;
            elem.select();
            document.execCommand('copy');
            document.body.removeChild(elem);

            showSnackbar("Copied!");

            return false;
        }

        function showSnackbar(msg) {
          var x = document.getElementById("snackbar");
          x.innerText = msg;
          x.className = "show";
          setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }
        
    </script>
    
{% endblock %}